16/jun/17   [X] Impedir que aparezca ningún log.

                - solución:

                        buildTypes {
                                release {
                                    minifyEnabled true  // recordar dejarlo en false mientras no
                                                        // se publica la versión Release.

16/jun/17   [X] En ocasiones al cambiar de población (una población previamente añadida), se muestra
                el título correctamente, pero tras cargarse el cache correcto, se descargan los
                datos de otra población.  Cuando la conexión es lenta sucede más amenudo.

                - solución: En AddressResultReceiver.onReceiveResult hacemos que si obtenemos
                FAILURE_RESULT vuelva a intentar startActionScrap con la misma población.

16/jun/17   [X] el pulsar <-' la aplicación finaliza y muestra "aplicación detenida de forma imprevista"

                Es necesario recuperar Los fragments de SavedInstanceState.
                - solucionado por fuerza bruta:  try / catch



16/jun/17   [X] Sería más correcto que mientras se descargan los datos con realizarPeticionesHttp
                se mostrará un reloj de arena aunque apareciera en el fondo los datos del caché.

                - solución:
                    ProgressDialog

17/jun/17   [X] Aumentar precisión de geolocalización.

                - solución:
                    onLocationChanged(Location location) {
                            localizacionConseguida(location);   // antes no se pasaba location
                                                                // se usaba fused.

22/jul/17   [x] Se añade una barra de progreso de carga de los datos en:
                    ResponseReceive.onReceive ...  progressBar.dismiss()
                    conectarApiGoogle ... progressBar.show()
                    cambioPoblacion ... progressBar.show()


19/jun/17   [X] Cuando el usuario haga click en un estación de servicio de la lista, desplegar
                el drawerList y posicionar el mapa en la estación de servicio elegida, de modo que
                el usuario puede pedir en el mapa verlo en GoogleMaps para ser guiado.

6/ago/17    [X] En el DrawerList, mostrar un icono en el primer elemento indicando que es la
                población en la que estamos y no una de la lista añadida con anterioridad.

                - solución: Ha sido necesario crear DrawerListAdapter sustituyendo el SwipeDrawerList
                            genérico.  Además ha sido necesario retocar la manera de funcionar del
                            onTouchListener para el contenedor de cada opción de menú en lugar de
                            para el texto.

6/ago/17    [X] Cuando el usuario hace clic en una estación, se despliega el mapa pero si estamos
                visualizando una aplicación diferente a la que estamos por gps, se muestra una
                calle que exista en el mapa de la localización actual, en lugar de la población
                seleccionada de la lista.

                - Solución: Ya estaba bien excepto que utilizaba mLocation de la localización general
                            en lugar de la localización de la Estación.

6/ago/17    [X] Al hacer clic en una estación, debería acercarse la imagen a nivel de calle en el
                mapa, más cerca que en el mapa de la población en genera.  También debería iluminarse
                la linea de la estación al seleccionarla, como en un menú.

16/jun/17   [X] Al hacer gesto a la izquierda en el DrawerView debería cerrarse incluso al tocar
                fuera de la lista.

                - Solución: Se vuelve a bloquear swipeLeft y ponemmos un botón en el drawer superior
                            para cerrar el drawer.

____________________________________________________________________________________________________

15/ago/17   [!] Algunas direcciones de Estaciones no las reconoce bien y muestra en el mapa
                poblaciones de otros países.
                GeocoderHelper.fetchLocationUsingGooglemap()

27/ago/17   [ ] Reformaremos la totalidad del código para utilizar únicamente los documentos Json
                que ofrece Mityc:

                - Lista de provincias y sus códigos:
                    https://sedeaplicaciones.minetur.gob.es/ServiciosRESTCarburantes/PreciosCarburantes/Listados/Provincias/

                - Lista de municipios por provincia:
                    https://sedeaplicaciones.minetur.gob.es/ServiciosRESTCarburantes/PreciosCarburantes/Listados/MunicipiosPorProvincia/{provincia}

                - Lista de estaciones por población:
                    https://sedeaplicaciones.minetur.gob.es/ServiciosRESTCarburantes/PreciosCarburantes/EstacionesTerrestres/FiltroMunicipio/{cod}

                Pondremos cada Receiver y cada tarea asíncrono en un archivo .java independiente para
                aumentar la claridad del código.  También lo renombraremos para clarificar el uso
                que se le dé.

                El código para leer Servicios Web Json:

                    Se podría guardar el archivo poblaciones.csv con los nombres de población sin
                    modificar tal como vienen en el Servicio Rest.  Se podría obtener con Python.
                    Ya no sería necesario los códigos según JavaScript (scraping) y tampoco sería
                    necesario procesar nombres de poblaciones porque sería exactamente iguales que
                    en el servicio Rest.
                    El servicio Rest nos ofrecería por cada estación la latitud/longitud.

                    WebServiceJsonGetEstacionesPorPoblacion
                    ResultReceiverEstacionesPorPoblacion


11/set/17   [X] Movemos AddressResultReceiver a una clase independiente dentro de com.corral.mityc
                y lo llamamos CityNameResultReceiverFromGeocoder.java.

11/set/17   [X] Movemos CoordenadasResultReceiver a una clase independiente dentro de com.corral.mityc
                y lo llamamos LocationPoblacionCentroResultReceiver.java.
                También cambiamos de nombre FetchLocationIntentService a LocationPoblacionCentroIntentService.

11/set/17   [X] Cambiamos el nombre de ServicioScrapMityc a ScrapWebMitycIntentService y movemos
                ResponseReceiver a una clase independiente y la llamamos ScrapWebMitycReceiver.

11/set/17   [X] falta mover fuera de MitycRubi GeocoderLocationResultReceiver y cambiarle el nombre
                a LocationEstacionResultReceiver.
                También estaría bien crear paquetes para diferenciar clases Estacion,Producto,etcc
                MitycRubi, etc.


15/mar/18   [X] Tras crear los métodos para leer los servicios web Json de Mityc y así obtener
                las posiciones geograficas de las estaciones, ahora cuando se visualiza una población
                distinta a la que nos encontremos actualmente, no se lee correctamente.
                Al cambiar de población con MitycRubi cambioPoblacion() no se cambia.  Lee la
                población actual.  Para corregirlo habrá que hacer que el archivo poblacions.csv
                contenta únicamente los códigos de mityc WS, no los de scrapping.  Luego habrá que
                asegurarse que CityNameResultReceiverFromGeocoder.onReceiveResult envíe el código
                de la población selecciona y no la detectada por gps según corresponda.

27/mar/18   [X] Cambiar el icono del Drawer al cerrar, en lugar de una flecha a la izquierda, poner
                una X.

27/mar/18   [X] Al crear una nueva población, la muestra pero enseguida aparece de nuevo la población
                en la que estamos en lugar de la que acabamos de seleccionar.

30/mar/18   [X] Al crear una población, no se actualiza el mapa a la localidad seleccionada.
                La siguiente vez sí que se actualiza.

                Solución: En MitycRubi.onMapReady() eliminamos la condición (mLastLocation != null)
                ya que ya no utilizamos la localización gps en esta parte del código, sinó el
                nombre de la población.


31/mar/18   [X] Al pulsar el botón Back desaparece el nombre de la población y el DrawerButton.
                No se ve el toolBar.  Ocurre si estamos en nueva población para añadir una nueva
                localidad.

                solución: En MitycRubi.onActivityResult() forzamos que se visualice el Toolbar
                al volver de NuevaPoblación.


1/abr/18    [X] Mostrar iconos de EE.SS. en el mapa.

2/abr/18    [x] Eliminar todos los getProvider SetProvider porque ya no son necesarios.

2/abr/18    [X] Borrar los logs y printlns.

27/mar/18   [X] Aumentar el nivel de precisión de población, no debería encontrar sólo las ciudades
                grandes, sinó trambién las pequeñas como La Floresta en lugar de Sant Cugat o
                Barcelona - Sarrià en lugar de sólo Barcelona.  Aunque podría haber un problema
                al buscar estaciones en el caso de Sarrià etc...

                solución: se afina la extracción de datos de la respuesta Json de
                GeocoderHelperConAsynctask y de fetchCityNameUsingGoogleMap().  Por superar el
                número máximo de peticiones a http://maps.googleapis.com/maps/api/geocode/json?latlng=
                no podemos hacer las pruebas hoy.  Faltaría ver si la condición
                 ("neighborhood".equals(types.getString(k))) cumple con lo esperado.

                 Sustituimos neighborhood por route y en lugar de devolvernos un barrio, nos
                 devuelve la calle (de momento lo dejamos así ya que no parece que en el
                 resultado Json algo indique el nombre de un barrio).

27/mar/18   [X] En algunas localización devuelve null como población.
                Solución:  Parece que al depurar el código no se ha vuelto a producir este error.

3/abr/18    [X] Puede haber poblaciones con mismo nombre y al hacer búsqueda fallar si no se
                especifica la provincia.  Se añade PROV_DRAWERLIST y se le asigna valor cuando
                se cree una nueva población y cuando se detecta la posición gps.
                Pero al cambiar de población, no tenemos forma de obtener la provincia, así que
                habrá que añadir un String a SharedPreferences para que al cambiar de población
                podamos indicar la provincia para omitir errores en el posicionamiento del mapa.

                solución: modificamos getListaCodPoblaciones(), deleteListaCodPoblaciones() y
                setListaCodPoblaciones(), pero falta que cada vez que asignemos valor a
                PROV_DRAWERLIST se guarde convenientemente en onActivityResult(), y que se
                utilice cuando se cambie de población en cambioPoblacion().
                Asegurarse que en onMapReady() se recibe la provincia correctamente.


5/abr/18    [x] Mientras el usuario no hay aceptado los permisos de la aplicación , la aplicación
                debe mostrar un mensaje avisando que mientras no se acepten no puede funcionar
                ya que toda la aplicación depende de ello.

                solución:  ver onRequestPermissionsResult(), permisosGps() y infoPermisos()


5/abr/18    [X] Si se ha iniciado la aplicación sin acceso a datos y ha quedado vacía la tabla
                y a continuació abrimos el DrawerList y hacemos click en población actual aunque
                esté en blanco, aparece un ANR.  Si se produce este fallo, a partir de ese
                momento, cada vez que se inicia la app, no se carga la población actual aunque
                sí las que estén en la lista del drawerlist.


5/abr/18    [X] Al detectar la población , si se pierde la conexión, se queda el nombre de la población
                actual, pero permanecen los datos de la anterior.
                Parece que no se carga el caché si no hay conexión.
                No hay mensajes de aviso cuando no hay conexión.  Habría que añadir mensajes de
                aviso cuando hay problemas para acceder a Internet.

                Si no se detecta la ubicación no hay problema por que sencillamente, no retorna
                el flujo del programa hasta que se recibe onConnected().



3/abr/18    [ ] Limpiar el código.

X


